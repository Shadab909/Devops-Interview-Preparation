In this video, we will be talking about sudo or sudo.

Howsoever you want to call it, we have executed this command so many times, sudo -i, that will switch to

user to root user, but it's only the vagrant user that can do it.

Not any other user will also. We will also test it now.

But if you want, you can give any other user privilege to switch to root user or execute command with

root privilege by adding the users into sudoers file.

So sudo acts like a power of attorney on behalf of root user, someone, some normal user can

execute root commands or even switch to rot user.

So let's see how that can be done.

So I will just log in, I do vagrant ssh and we know it will log in with vagrant user. So logged in

as vagrant user, but vagrant user has privilege to do sudo, can do sudo -i

Or can execute root commands like for example I can do sudo yum install.

Let's say git

I don't want to see its output's, I'm just going to send it to /dev/null

You know what?

Let's see the output.

So you see thats working.

But if I do not use the sudo command over will here, I just I don't prefix with sudo, just say yum install git

It's going to throw me an error or if I try to add a user.

Throws me an error, but I can do that by using sudo as a prefix, and that's happening because a

vagrant user has privilege to execute sudo

Can also switch to root user by doing sudo -i

Now, let's switch to another user.

Let's see ansible user that we have created in previous video.

And if this user is trying to do sudo before this, let's set a password for this user because we

will need it, passwd

ansible

OK, the reason why I set password for this user, you will know in a moment.

So I switched to ansible user.

And we can do, we are root user.

And if I try to do sudo useradd.

test12, so trying to add a username test12

OK, it's asking me password for Ansible, OK, it's asking me my own password as ansible password,

which I have already set, so I'm going to enter that password.

OK, throws me an error. Ansible is not in the sudoers file file, this incident will be reported.

So that's an error.

We can't do that, the ansible user cannot do that switch.

sudo -i

And I it's asking password for the ansible user again.

And remember, this is the user password, not the root password.

.

OK, let's exit from this user.

Let's clear the screen now I want ansible user to execute sudo commands.

So I have one simple way, which is I will run a command visudo, this command will open the /etc/sudoers

file in the write mode.

.

So let me quit again.

Before I do that, let me show you the file /etc/sudoers

Yes, that's the path and you see does not have write permission even for the root users, so you can't

can't just do vim /etc/sudoers file

It's going to throw you an error when you're trying to edit the file.

And that's for security reasons.

It's done.

You don't change the permission of this file.

You just run the command visudo, which will open this file in the write mode in vim

There's really a lot of content in this file.

We are looking for a user called as root. So search for root, n for next.

Next.

There I set the line number, so it's much visible.

All right, so line number 100, I have the root user information. I want to add the ansible user, so

I'm going to copy this line and just paste it and change that line for user ansible.

OK, do not update that line number 100 that you're seeing, just add a new line and save and quit.

OK, now let's switch to Ansible user and from Ansible, let's now try to do sudo -i.

Its asking the password.

Let's enter it.

And tadaaa, it's working now, but it's interactive, it's asking me password for my user login the

ansible user. If you don't want that, which will not need when we're executing scripts in the background.

I don't want it to be interactive.

So I'm going to open visudo again with root User.

Search for Ansible.

And I have to give an entry over here, nopasswd.

Which means do not ask Ansible user its own password when it's trying to do sudo.

And let's save and quit this.

OK, now let's switch to ansible user again.

And now try to do sudo -i from here, you see no password asked.

Or ansible user can just do sudo or do some root operation, like adding a user. Lets try again.

test12 and that worked.

OK, now exit from here.

OK, coming back to the root user prompt.

So we have seen we have the/etc/sudoers file, we can update that, but if you make any syntax error in this

file, I'll show you.

Lets run visduo again and I just put some content there.

I made some syntax error and I am trying to save it.

So it will find that there is a syntax error in this file at line number nine and it's going to say,

what now?

So you have to say e to edit it back and go to that line number nine and fix it and then save & quit.

So you see there is a chance of human error.

In that file, and that will lead to a non-functional sudoers files, so sudo command will not work then.

If you save that file, sudoers command will not work and you will be stuck.

If you don't have the root password, which most of the servers will not have the root password set

for security purpose. You will have normal user login like we have vagrant user. We will have any other

normal user login and then that can be switched to root user by using sudo.

So if you want to fix that file, it will be a problem because the sudo will not work and you don't

have the root password.

Sure, there are some other methods, but that will lead to more problems.

So the better solution is instead of editing that sudoers file, you go to /etc/sudoers.d directory

here you can create your own file.

You will see there is a file called as vagrant.

And it has the content like that, you can create your own file.

Let's see, I create a file for devops.

And I edit that file and I want to add the devops group in that, and when you want to add a group,

you have to say % percent and the group name.

Percent % means the group, devops is a group and not a user, and you can, save and quit.

And now any user which belongs to devops group can do sudo or you can add really the user name also there

instead of group.

So this is a much safer option.

Compared to directly editing the source file.

Sure, there are many more options in the sudoers file, you can give special commands for a particular

user to execute.

But that's all for now in sudoers, so practice this, make sure you get it very well.

And once you're done practicing over here, join me in the next video.